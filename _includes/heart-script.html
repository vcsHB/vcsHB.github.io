<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js">
</script>

<script>
    const SECRET_SALT = "vcs_portfolio_2025";
    const GAS_URL =
        'https://script.google.com/macros/s/AKfycbzIex3Sdy37cyePa8FWlxWNQVVgC2dRvgD6up8qADnbh-VB5r4WK60xZWxTmuQCPZ0B/exec';

    function generateHash(id) {
        return btoa(encodeURIComponent(id + "_" + SECRET_SALT));
    }

    window.handleHeartClick = function (btn, id) {
        const countSpan = btn.querySelector('.heart-count');
        const storageKey = 'heart-' + id;
        const currentHash = localStorage.getItem(storageKey);

        if (!countSpan || currentHash === generateHash(id)) return;

        let currentCount = parseInt(countSpan.innerText) || 0;
        countSpan.innerText = currentCount + 1;

        btn.style.transform = "scale(1.3)";
        localStorage.setItem(storageKey, generateHash(id));

        setTimeout(() => {
            btn.style.transform = "scale(1)";
            btn.disabled = true;
            btn.style.opacity = "0.5";
        }, 200);

        fetch(`${GAS_URL}?action=add&id=${id}`, {
                method: 'GET',
                redirect: 'follow'
            })
            .then(res => res.text())
            .then(newCount => {
                if (newCount) countSpan.innerText = newCount;
            });
    };

    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll('.heart-count').forEach(targetSpan => {
            const projectId = targetSpan.id.replace('count-', '');
            const btn = targetSpan.closest('button');

            if (localStorage.getItem('heart-' + projectId) === generateHash(projectId)) {
                btn.disabled = true;
                btn.style.opacity = "0.5";
            }

            targetSpan.innerHTML = '<span class="loading-spinner"></span>';

            fetch(`${GAS_URL}?action=get&id=${projectId}`, {
                    method: 'GET',
                    redirect: 'follow'
                })
                .then(res => res.text())
                .then(count => {
                    targetSpan.innerText = count || 0;
                })
                .catch(() => {
                    targetSpan.innerText = 0;
                });
        });
    });
</script>