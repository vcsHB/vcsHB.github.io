<script>
    const GAS_URL =
        'https://script.google.com/macros/s/AKfycbzIex3Sdy37cyePa8FWlxWNQVVgC2dRvgD6up8qADnbh-VB5r4WK60xZWxTmuQCPZ0B/exec';

    window.handleHeartClick = function (btn, id) {
        const countSpan = btn.querySelector('.heart-count');
        if (!btn || btn.style.pointerEvents === 'none') return;

        btn.style.pointerEvents = 'none';

        fetch(`${GAS_URL}?action=add&id=${id}`, {
                method: 'GET',
                redirect: 'follow'
            })
            .then(res => res.text())
            .then(newCount => {
                if (countSpan && newCount) {
                    countSpan.innerText = newCount;
                }
                btn.style.transform = "scale(1.3)";
                setTimeout(() => {
                    btn.style.transform = "scale(1)";
                    btn.style.pointerEvents = 'auto';
                }, 200);
            })
            .catch(err => {
                console.error("Heart Click Error:", err);
                btn.style.pointerEvents = 'auto';
            });
    };

    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll('.heart-count').forEach(targetSpan => {
            const projectId = targetSpan.id.replace('count-', '');

            fetch(`${GAS_URL}?action=get&id=${projectId}`, {
                    method: 'GET',
                    redirect: 'follow'
                })
                .then(res => res.text())
                .then(count => {
                    if (count !== undefined && targetSpan) {
                        targetSpan.innerText = count;
                    }
                })
                .catch(err => console.error("Heart Load Error:", err));
        });

        const searchInput = document.getElementById('projectSearchInput');
        const cards = document.querySelectorAll('.project-card');
        const emptyMessage = document.getElementById('emptyResultMessage');

        if (searchInput) {
            searchInput.addEventListener('input', function (e) {
                const searchTerm = e.target.value.toLowerCase().replace(/\s+/g, '');
                let visibleCount = 0;

                cards.forEach(card => {
                    const title = card.getAttribute('data-search-title') || "";
                    if (title.includes(searchTerm)) {
                        card.style.display = 'flex';
                        visibleCount++;
                    } else {
                        card.style.display = 'none';
                    }
                });

                if (emptyMessage) {
                    emptyMessage.style.display = (visibleCount === 0 && searchTerm !== "") ? 'block' :
                        'none';
                }
            });
        }
    });
</script>