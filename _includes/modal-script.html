<script src="https://cdn.jsdelivr.net/npm/marked@15.0.0/lib/marked.umd.min.js">
</script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js">
</script>

<script>
    function openModal(cardElement, isInitialLoad = false) {
        const modal = document.getElementById("portfolioModal");
        const modalBody = document.getElementById("modalBody");
        const modalTitle = document.getElementById("modalTitle");
        const modalThumbnail = document.getElementById("modalThumbnail");
        const modalCategories = document.getElementById("modalCategories");

        if (!cardElement || !modal || !modalBody) return;

        const title = cardElement.querySelector('h3').innerText.trim();

        modalTitle.innerText = title;
        modalThumbnail.src = cardElement.querySelector('.thumbnail-container img').src;
        modalCategories.innerHTML = cardElement.querySelector('.project-categories').innerHTML;
        modalBody.innerHTML = marked.parse(cardElement.querySelector('.project-content-raw').innerHTML);

        modal.style.display = "block";
        document.body.style.overflow = "hidden";
        Prism.highlightAll();

        const newUrl = new URL(window.location);
        newUrl.searchParams.set('project', title);

        if (isInitialLoad) {
            window.history.replaceState({
                isModal: true
            }, '', newUrl);
        } else {
            window.history.pushState({
                isModal: true
            }, '', newUrl);
        }
    }

    function closeModal(isPopState = false) {
        const modal = document.getElementById("portfolioModal");
        if (!modal || modal.style.display === "none") return;

        modal.style.display = "none";
        document.body.style.overflow = "auto";

        if (isPopState !== true) {
            const newUrl = new URL(window.location);
            newUrl.searchParams.delete('project');
            window.history.pushState({}, '', newUrl);
        }
    }
</script>