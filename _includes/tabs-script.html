<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>

<script>
    function openTab(evt, tabName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
            tabcontent[i].classList.remove("active");
        }
        tablinks = document.getElementsByClassName("tab-link");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].classList.remove("active");
        }
        document.getElementById(tabName).style.display = "block";
        document.getElementById(tabName).classList.add("active");
        if (evt) evt.currentTarget.classList.add("active");

        const newUrl = new URL(window.location);
        newUrl.searchParams.set('tab', tabName);
        newUrl.searchParams.delete('project');
        window.history.pushState({
            tab: tabName
        }, '', newUrl);
    }

    function loadProfileReadme() {
        const readmeContentContainer = document.getElementById('profileReadmeContent');
        const readmeMainContainer = document.querySelector('.github-profile-readme');

        if (!readmeContentContainer || readmeContentContainer.innerHTML.trim() !== "") return;

        fetch('/assets/profile.md')
            .then(response => {
                if (!response.ok) throw new Error('404');
                return response.text();
            })
            .then(markdown => {
                if (window.marked) {
                    readmeContentContainer.innerHTML = marked.parse(markdown);
                    if (window.Prism) Prism.highlightAll();
                    setTimeout(() => readmeMainContainer.classList.add('active'), 50);
                }
            })
            .catch(() => {
                readmeContentContainer.innerHTML = '<p>README를 불러올 수 없습니다. (/assets/profile.md 파일을 확인하세요)</p>';
            });
    }

    document.addEventListener("DOMContentLoaded", function () {
        const activeTab = document.querySelector('.tab-link.active');
        if (activeTab) {
            const onclickAttr = activeTab.getAttribute('onclick');
            if (onclickAttr && onclickAttr.includes('Profile')) {
                loadProfileReadme();
            }
        }
    });

    document.addEventListener("DOMContentLoaded", function () {
        const slider = document.getElementById('techSlider');
        if (!slider) return;

        let isDown = false;
        let startX;
        let scrollLeft;

        slider.addEventListener('mousedown', (e) => {
            isDown = true;
            slider.style.cursor = 'grabbing';
            startX = e.pageX - slider.offsetLeft;
            scrollLeft = slider.scrollLeft;
        });
        slider.addEventListener('mouseleave', () => {
            isDown = false;
            slider.style.cursor = 'grab';
        });
        slider.addEventListener('mouseup', () => {
            isDown = false;
            slider.style.cursor = 'grab';
        });
        slider.addEventListener('mousemove', (e) => {
            if (!isDown) return;
            e.preventDefault();
            const x = e.pageX - slider.offsetLeft;
            const walk = (x - startX) * 2;
            slider.scrollLeft = scrollLeft - walk;
        });
    });
</script>